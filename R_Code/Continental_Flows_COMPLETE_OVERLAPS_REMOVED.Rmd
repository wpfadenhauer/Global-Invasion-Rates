---
title: "Continental_Flows with COMPLETE OVERLAPS REMOVED"
author: "Will Pfadenhauer"
date: "11/7/2022"
output: html_document
---

# **Load data & packages**

```{r}
require(data.table)
require(dplyr)
require(tidyr)

#Load data
full_list <- fread("C:/Users/wpfadenhauer/OneDrive - University of Massachusetts/CH2_InvaderFlows/R_files/Final_Simple_Database.csv")


#Make a Data Table to Store Source Results
AllContsSources <- data.table()
AllContsSources$Continent <- c("Europe", "Africa", "Asia Temperate", "Asia Tropical", "Australasia", "Pacific", "Northern America", "Southern America", "Antarctic")
AllContsSources$EstablishedSpecies <- ""
AllContsSources$InvasiveSpecies <- ""


#Make a Data Table to Store Destination Results
AllContsDestinations <- data.table()
AllContsDestinations$Continent <- c("Europe", "Africa", "Asia Temperate", "Asia Tropical", "Australasia", "Pacific", "Northern America", "Southern America", "Antarctic")
AllContsDestinations$EstablishedSpecies <- ""
AllContsDestinations$InvasiveSpecies <- ""

```

# **Continents**

These are broken down by the World Geographical Scheme for Recording Plant Distributions (WGSRPD). The continents and their numbers here are equivalent to the L1 categories. See <https://en.wikipedia.org/wiki/List_of_codes_used_in_the_World_Geographical_Scheme_for_Recording_Plant_Distributions> for more info.

## **1 - Europe**

### **Invasions in this continent (destinations)**

The word "Invasions" in this document references species that have arrived in these continents and had negative impacts. This contrasts with the word "sources" (see next code chunk), which are the species that originated from each continent and went elsewhere to have negative impacts.

```{r}
#Need species with Invasive L1 =1
Europe_I <- full_list[grep("1", full_list$Invasive_L1),]

#Remove species with Native L1 =1 
Europe_I <- Europe_I[!grep("^1$", Europe_I$Native_L1), ]

#Remove excess columns
Europe_I <- Europe_I[,c(1)]

#Label as invasive
Europe_I$type = "1"

#Need species with Established L1=1
Europe_E <- full_list[grep("1", full_list$Established_L1)]

#Remove species with Native L1 = 1
Europe_E <- Europe_E[!grep("^1$", Europe_E$Native_L1), ]

#Remove species with Invasive L1 = 1
Europe_E <- Europe_E[!grep("1", Europe_E$Invasive_L1), ]

#Remove excess columns
Europe_E <- Europe_E[,c(1)]

#Label as established
Europe_E$type = "0"

#Rbind Invaders to Established 
Europe <- rbind(Europe_I, Europe_E)

europe_count <- table(Europe$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Europe", EstablishedSpecies:= europe_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Europe", InvasiveSpecies:= europe_count[2]]

rm(Europe)
rm(Europe_E)
rm(Europe_I)
```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =1
Europe_N <- full_list[grep("1", full_list$Native_L1)]

#Remove species with Established L1 =1 
Europe_N <- Europe_N[!grep("^1$", Europe_N$Established_L1), ]

#Remove species with Invasive L1 =1 
Europe_N <- Europe_N[!grep("^1$", Europe_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Europe", EstablishedSpecies:= paste(sum(Europe_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Europe", InvasiveSpecies:= paste(sum(Europe_N$status=="invasive"))]

rm(Europe_N)

```

## **2 - Africa**

### **Invasions in this continent (destinations)**

```{r}
#Need species with Invasive L1 =2
africa_I <- full_list[grep("2", full_list$Invasive_L1)]

#Remove species with Native L2 =2 
africa_I <- africa_I[!grep("^2$", africa_I$Native_L1), ]

#Remove excess columns
africa_I <- africa_I[,c(1)]

#Label as invasive
africa_I$type = "1"

#Need species with Established L1=2
africa_E <- full_list[grep("2", full_list$Established_L1)]

#Remove species with Native L1 = 2
africa_E <- africa_E[!grep("^2$", africa_E$Native_L1), ]

#Remove species with Invasive L1 = 2
africa_E <- africa_E[!grep("2", africa_E$Invasive_L1), ]

#Remove excess columns
africa_E <- africa_E[,c(1)]

#Label as established
africa_E$type = "0"

#Rbind Invaders to Established 
africa <- rbind(africa_I, africa_E)

africa_count <- table(africa$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Africa", EstablishedSpecies:= africa_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Africa", InvasiveSpecies:= africa_count[2]]


rm(africa)
rm(africa_E)
rm(africa_I)

```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =2
africa_N <- full_list[grep("2", full_list$Native_L1)]

#Remove species with Established L1 =2 
africa_N <- africa_N[!grep("^2$", africa_N$Established_L1), ]

#Remove species with Invasive L1 =2
africa_N <- africa_N[!grep("^2$", africa_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Africa", EstablishedSpecies:= paste(sum(africa_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Africa", InvasiveSpecies:= paste(sum(africa_N$status=="invasive"))]

rm(africa_N)

```

## **3 - Asia Temperate**

### **Invasions in this continent (destinations)**

```{r}
#Need species with Invasive L1 =3
asia_temperate_I <- full_list[grep("3", full_list$Invasive_L1)]

#Remove species with Native L2 =3 
asia_temperate_I <- asia_temperate_I[!grep("^3$", asia_temperate_I$Native_L1), ]

#Remove excess columns
asia_temperate_I <- asia_temperate_I[,c(1)]

#Label as invasive
asia_temperate_I$type = "1"

#Need species with Established L1=3
asia_temperate_E <- full_list[grep("3", full_list$Established_L1)]

#Remove species with Native L1 = 3
asia_temperate_E <- asia_temperate_E[!grep("^3$", asia_temperate_E$Native_L1), ]

#Remove species with Invasive L1 = 3
asia_temperate_E <- asia_temperate_E[!grep("3", asia_temperate_E$Invasive_L1), ]

#Remove excess columns
asia_temperate_E <- asia_temperate_E[,c(1)]

#Label as established
asia_temperate_E$type = "0"

#Rbind Invaders to Established 
asia_temperate <- rbind(asia_temperate_I, asia_temperate_E)

asia_temperate_count <- table(asia_temperate$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Asia Temperate", EstablishedSpecies:= asia_temperate_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Asia Temperate", InvasiveSpecies:= asia_temperate_count[2]]


rm(asia_temperate)
rm(asia_temperate_E)
rm(asia_temperate_I)

```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =3
asia_temperate_N <- full_list[grep("3", full_list$Native_L1)]

#Remove species with Established L1 =3 
asia_temperate_N <- asia_temperate_N[!grep("^3$", asia_temperate_N$Established_L1), ]

#Remove species with Invasive L1 =3
asia_temperate_N <- asia_temperate_N[!grep("^3$", asia_temperate_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Asia Temperate", EstablishedSpecies:= paste(sum(asia_temperate_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Asia Temperate", InvasiveSpecies:= paste(sum(asia_temperate_N$status=="invasive"))]

rm(asia_temperate_N)

```

## **4 - Asia Tropical**

### **Invasions in this continent (destinations)**

```{r}
#Need species with Invasive L1 =4
asia_tropical_I <- full_list[grep("4", full_list$Invasive_L1)]

#Remove species with Native L2 =4
asia_tropical_I <- asia_tropical_I[!grep("^4$", asia_tropical_I$Native_L1), ]

#Remove excess columns
asia_tropical_I <- asia_tropical_I[,c(1)]

#Label as invasive
asia_tropical_I$type = "1"

#Need species with Established L1=4
asia_tropical_E <- full_list[grep("4", full_list$Established_L1)]

#Remove species with Native L1 = 4
asia_tropical_E <- asia_tropical_E[!grep("^4$", asia_tropical_E$Native_L1), ]

#Remove species with Invasive L1 = 4
asia_tropical_E <- asia_tropical_E[!grep("4", asia_tropical_E$Invasive_L1), ]

#Remove excess columns
asia_tropical_E <- asia_tropical_E[,c(1)]

#Label as established
asia_tropical_E$type = "0"

#Rbind Invaders to Established 
asia_tropical <- rbind(asia_tropical_I, asia_tropical_E)

asia_tropical_count <- table(asia_tropical$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Asia Tropical", EstablishedSpecies:= asia_tropical_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Asia Tropical", InvasiveSpecies:= asia_tropical_count[2]]


rm(asia_tropical)
rm(asia_tropical_E)
rm(asia_tropical_I)

```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =4
asia_tropical_N <- full_list[grep("4", full_list$Native_L1)]

#Remove species with Established L1 =4 
asia_tropical_N <- asia_tropical_N[!grep("^4$", asia_tropical_N$Established_L1), ]

#Remove species with Invasive L1 =4
asia_tropical_N <- asia_tropical_N[!grep("^4$", asia_tropical_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Asia Tropical", EstablishedSpecies:= paste(sum(asia_tropical_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Asia Tropical", InvasiveSpecies:= paste(sum(asia_tropical_N$status=="invasive"))]

rm(asia_tropical_N)

```

## **5 - Australasia**

### **Invasions in this continent (destinations)**

```{r}
#Need species with Invasive L1 =5
australasia_I <- full_list[grep("5", full_list$Invasive_L1)]

#Remove species with Native L2 =5
australasia_I <- australasia_I[!grep("^5$", australasia_I$Native_L1), ]

#Remove excess columns
australasia_I <- australasia_I[,c(1)]

#Label as invasive
australasia_I$type = "1"

#Need species with Established L1=5
australasia_E <- full_list[grep("5", full_list$Established_L1)]

#Remove species with Native L1 = 5
australasia_E <- australasia_E[!grep("^5$", australasia_E$Native_L1), ]

#Remove species with Invasive L1 = 5
australasia_E <- australasia_E[!grep("5", australasia_E$Invasive_L1), ]

#Remove excess columns
australasia_E <- australasia_E[,c(1)]

#Label as established
australasia_E$type = "0"

#Rbind Invaders to Established 
australasia <- rbind(australasia_I, australasia_E)

australasia_count <- table(australasia$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Australasia", EstablishedSpecies:= australasia_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Australasia", InvasiveSpecies:= australasia_count[2]]


rm(australasia)
rm(australasia_E)
rm(australasia_I)

```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =5
australasia_N <- full_list[grep("5", full_list$Native_L1)]

#Remove species with Established L1 =5 
australasia_N <- australasia_N[!grep("^5$", australasia_N$Established_L1), ]

#Remove species with Invasive L1 =5
australasia_N <- australasia_N[!grep("^5$", australasia_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Australasia", EstablishedSpecies:= paste(sum(australasia_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Australasia", InvasiveSpecies:= paste(sum(australasia_N$status=="invasive"))]

rm(australasia_N)

```

## **6 - Pacific**

### **Invasions in this continent (destinations)**

```{r}
#Need species with Invasive L1 =6
pacific_I <- full_list[grep("6", full_list$Invasive_L1)]

#Remove species with Native L2 =6
pacific_I <- pacific_I[!grep("^6$", pacific_I$Native_L1), ]

#Remove excess columns
pacific_I <- pacific_I[,c(1)]

#Label as invasive
pacific_I$type = "1"

#Need species with Established L1=6
pacific_E <- full_list[grep("6", full_list$Established_L1)]

#Remove species with Native L1 = 6
pacific_E <- pacific_E[!grep("^6$", pacific_E$Native_L1), ]

#Remove species with Invasive L1 = 6
pacific_E <- pacific_E[!grep("6", pacific_E$Invasive_L1), ]

#Remove excess columns
pacific_E <- pacific_E[,c(1)]

#Label as established
pacific_E$type = "0"

#Rbind Invaders to Established 
pacific <- rbind(pacific_I, pacific_E)

pacific_count <- table(pacific$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Pacific", EstablishedSpecies:= pacific_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Pacific", InvasiveSpecies:= pacific_count[2]]


rm(pacific)
rm(pacific_E)
rm(pacific_I)

```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =6
pacific_N <- full_list[grep("6", full_list$Native_L1)]

#Remove species with Established L1 =6 
pacific_N <- pacific_N[!grep("^6$", pacific_N$Established_L1), ]

#Remove species with Invasive L1 =6
pacific_N <- pacific_N[!grep("^6$", pacific_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Pacific", EstablishedSpecies:= paste(sum(pacific_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Pacific", InvasiveSpecies:= paste(sum(pacific_N$status=="invasive"))]

rm(pacific_N)

```

## **7 - Northern America**

### **Invasions in this continent (destinations)**

```{r}
#Need species with Invasive L1 =7
northern_america_I <- full_list[grep("7", full_list$Invasive_L1)]

#Remove species with Native L2 =7
northern_america_I <- northern_america_I[!grep("^7$", northern_america_I$Native_L1), ]

#Remove excess columns
northern_america_I <- northern_america_I[,c(1)]

#Label as invasive
northern_america_I$type = "1"

#Need species with Established L1=7
northern_america_E <- full_list[grep("7", full_list$Established_L1)]

#Remove species with Native L1 = 7
northern_america_E <- northern_america_E[!grep("^7$", northern_america_E$Native_L1), ]

#Remove species with Invasive L1 = 7
northern_america_E <- northern_america_E[!grep("7", northern_america_E$Invasive_L1), ]

#Remove excess columns
northern_america_E <- northern_america_E[,c(1)]

#Label as established
northern_america_E$type = "0"

#Rbind Invaders to Established 
northern_america <- rbind(northern_america_I, northern_america_E)

northern_america_count <- table(northern_america$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Northern America", EstablishedSpecies:= northern_america_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Northern America", InvasiveSpecies:= northern_america_count[2]]


rm(northern_america)
rm(northern_america_E)
rm(northern_america_I)

```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =7
northern_america_N <- full_list[grep("7", full_list$Native_L1)]

#Remove species with Established L1 =7 
northern_america_N <- northern_america_N[!grep("^7$", northern_america_N$Established_L1), ]

#Remove species with Invasive L1 =7
northern_america_N <- northern_america_N[!grep("^7$", northern_america_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Northern America", EstablishedSpecies:= paste(sum(northern_america_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Northern America", InvasiveSpecies:= paste(sum(northern_america_N$status=="invasive"))]

rm(northern_america_N)

```

## **8 - Southern America**

### **Invasions in this continent (destinations)**

```{r}
#Need species with Invasive L1 =8
southern_america_I <- full_list[grep("8", full_list$Invasive_L1)]

#Remove species with Native L2 =8
southern_america_I <- southern_america_I[!grep("^8$", southern_america_I$Native_L1), ]

#Remove excess columns
southern_america_I <- southern_america_I[,c(1)]

#Label as invasive
southern_america_I$type = "1"

#Need species with Established L1=8
southern_america_E <- full_list[grep("8", full_list$Established_L1)]

#Remove species with Native L1 = 8
southern_america_E <- southern_america_E[!grep("^8$", southern_america_E$Native_L1), ]

#Remove species with Invasive L1 = 8
southern_america_E <- southern_america_E[!grep("8", southern_america_E$Invasive_L1), ]

#Remove excess columns
southern_america_E <- southern_america_E[,c(1)]

#Label as established
southern_america_E$type = "0"

#Rbind Invaders to Established 
southern_america <- rbind(southern_america_I, southern_america_E)

southern_america_count <- table(southern_america$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Southern America", EstablishedSpecies:= southern_america_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Southern America", InvasiveSpecies:= southern_america_count[2]]


rm(southern_america)
rm(southern_america_E)
rm(southern_america_I)
```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =8
southern_america_N <- full_list[grep("8", full_list$Native_L1)]

#Remove species with Established L1 =8
southern_america_N <- southern_america_N[!grep("^8$", southern_america_N$Established_L1), ]

#Remove species with Invasive L1 =8
southern_america_N <- southern_america_N[!grep("^8$", southern_america_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Southern America", EstablishedSpecies:= paste(sum(southern_america_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Southern America", InvasiveSpecies:= paste(sum(southern_america_N$status=="invasive"))]

rm(southern_america_N)

```

## **9 - Antarctic**

### **Invasions in this continent (destinations)**

```{r}
#Need species with Invasive L1 =9
antarctic_I <- full_list[grep("9", full_list$Invasive_L1)]

#Remove species with Native L2 =9
antarctic_I <- antarctic_I[!grep("^9$", antarctic_I$Native_L1), ]

#Remove excess columns
antarctic_I <- antarctic_I[,c(1)]

#Label as invasive
antarctic_I$type = "1"

#Need species with Established L1=9
antarctic_E <- full_list[grep("9", full_list$Established_L1)]

#Remove species with Native L1 = 9
antarctic_E <- antarctic_E[!grep("^9$", antarctic_E$Native_L1), ]

#Remove species with Invasive L1 = 9
antarctic_E <- antarctic_E[!grep("9", antarctic_E$Invasive_L1), ]

#Remove excess columns
antarctic_E <- antarctic_E[,c(1)]

#Label as established
antarctic_E$type = "0"

#Rbind Invaders to Established 
antarctic <- rbind(antarctic_I, antarctic_E)

antarctic_count <- table(antarctic$type)

AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Antarctic", EstablishedSpecies:= antarctic_count[1]]
AllContsDestinations <- setDT(AllContsDestinations)[Continent == "Antarctic", InvasiveSpecies:= antarctic_count[2]]


rm(antarctic)
rm(antarctic_E)
rm(antarctic_I)
```

### **Species from this continent (sources)**

```{r}
#Need species with Native L1 =9
antarctic_N <- full_list[grep("9", full_list$Native_L1)]

#Remove species with Established L1 =9
antarctic_N <- antarctic_N[!grep("^9$", antarctic_N$Established_L1), ]

#Remove species with Invasive L1 =9
antarctic_N <- antarctic_N[!grep("^9$", antarctic_N$Invasive_L1), ]

AllContsSources <- setDT(AllContsSources)[Continent == "Antarctic", EstablishedSpecies:= paste(sum(antarctic_N$status=="established"))]
AllContsSources <- setDT(AllContsSources)[Continent == "Antarctic", InvasiveSpecies:= paste(sum(antarctic_N$status=="invasive"))]

rm(antarctic_N)

```

# **Calculating Proportions**

### **Destinations**

```{r}

AllContsDestinations$EstablishedSpecies <- as.integer(AllContsDestinations$EstablishedSpecies)
AllContsDestinations$InvasiveSpecies <- as.integer(AllContsDestinations$InvasiveSpecies)
AllContsDestinations$Total <- (AllContsDestinations$EstablishedSpecies + AllContsDestinations$InvasiveSpecies)
AllContsDestinations$InvasionRate <- (AllContsDestinations$InvasiveSpecies/AllContsDestinations$Total)

#What's the average invasion rate for all continents?
mean(AllContsDestinations$InvasionRate)

#What about if we calculate it as a weighted average based on the number of species in each continent?
AllContsDestinations$PropOfTotal <- AllContsDestinations$Total / 12485
AllContsDestinations$WgtProp <- AllContsDestinations$PropOfTotal * AllContsDestinations$InvasionRate

totalprop<- sum(AllContsDestinations$PropOfTotal)
#This is allowed be be >1, since species invade multiple continents

#Here's the final weighted average
(sum(AllContsDestinations$WgtProp)/totalprop)

#Pretty darn close to our original average. 

#Make sure to remove all objects/values here before advancing to next code chunk. 
```

### **Sources**

```{r}

AllContsSources$EstablishedSpecies <- as.integer(AllContsSources$EstablishedSpecies)
AllContsSources$InvasiveSpecies <- as.integer(AllContsSources$InvasiveSpecies)
AllContsSources$Total <- (AllContsSources$EstablishedSpecies + AllContsSources$InvasiveSpecies)
AllContsSources$InvasionRate <- (AllContsSources$InvasiveSpecies/AllContsSources$Total)

#What's the average invasion rate for all continents?
mean(AllContsSources$InvasionRate)


#What about if we calculate it as a weighted average based on the number of species in each continent?

#Well how many species have native data in the dataset?
nativedata <- full_list[!Native_L1=="",]

AllContsSources$PropOfTotal <- AllContsSources$Total / 12230
AllContsSources$WgtProp <- AllContsSources$PropOfTotal * AllContsSources$InvasionRate

totalprop_s<- sum(AllContsSources$PropOfTotal)
#This is allowed be be >1, since species invade multiple continents

#Here's the final weighted average
(sum(AllContsSources$WgtProp)/totalprop_s)
```
